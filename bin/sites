#!/usr/bin/env bash
set -o errexit -o errtrace -o noclobber -o nounset -o pipefail
IFS=$'\n\t'

for d in /data/www/*/htdocs; do
  if [ -d "$d" ]; then
    echo --- "$d";

    if [ -e "$d/composer.json" ]; then
      echo ------ "composer";
      (cd "$d"; composer show --format=json)
    fi

    # Symfony

    if [ -e "$d/bin/console" ]; then
      echo ------ "symfony bin/console";
      "$d/bin/console" --version 2>/dev/null
    fi

    if [ -e "$d/app/console" ]; then
      echo ------ "symfony app/console";
      "$d/app/console" --version 2>/dev/null
    fi

    # Drupal

    if [ -e "$d/vendor/bin/drush" ]; then
      echo ------ "drupal app/console";
      "$d/vendor/bin/drush" status --fields=drush-version,drupal-version --format=json 2>/dev/null
    fi

  fi
done
